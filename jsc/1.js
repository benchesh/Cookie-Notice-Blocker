/* Developed by Ben Cheshire */
"use strict";const e=chrome.runtime?.id,o=e=>null!=e&&""!==e,t=(e,o)=>{for(const t of o)if(e===t)return!0;return!1},n=e=>{let o=[];for(const t in e)o.push(t);return o},i=e=>o(e)?(e.replace(/(;|)}/g,";}").replace(/(style="((.|\n)*?))"/g,'$1!important"').replace(/(style='((.|\n)*?))'/g,"$1!important'").replace(/;/g,"!important;").replace(/"]/g,'"i]')+(e.endsWith(";")||e.endsWith(">")||e.endsWith("}")?"":"!important")).replace(/((!important(;|)(((\s|\n)*?)|))*)!important(;|)/g,"!important;").replace(/\>(((\s|\n)*?)|)!important(;|)/g,">").replace(/important;}/g,"important}").replace(/important;"/g,'important"').replace(/important;'/g,"important'").replace(/}((\s|\n)*?)!important}/g,"}}"):"",r=["popup","flyout","choice","banner","announce","topbar","overlay","disclos","container","warning","compliance","messag","alert","dialog","prompt"],a=["HTML","HEADER","JSL","BODY","MAIN","SCRIPT","STYLE","LINK","NAV","ARTICLE"],c=["has-cookie-banner","entry-content","nav","ion-page","privacy-toggle-container","headerUniversalHeader","vjs-","mod-navigation"],s=["captify-widget","mol-ads-cmp","qc-cmp-ui","qc-cmp-persistent","cmpbox","site-message--first-pv-consent","cmp-container-id","bbccookies","msccBanner","privacy-content","privacy-prompt-wrapper","data-tracking-opt-in","ad-optly","cccwrpad","signup_wall_wrapper","eucookie","eu-cookie","eupopup","nav__cookie","cookie__h-subline","cc-stop-overlay","ub-emb-","tealium-cookies","tealiumgdpr","fc-consent-root","cybotcookie","cookieAcknowledgement","cookie-disclaimer","gdpr-cookie","gdprform","gdpr-content","gdprcontent","truste_overlay","truste_box","lnk-c-modal","notice--cookie","noticecookiescontent","ccgtm-wrapper","onetrust-consent-sdk","cli-modal-backdrop","cli-popupbar-overlay","cookie-law-info-bar","cookie-consent-alert","sncmp-container","c-cookieAccept","gdprsticky","guce-inline-consent","modal--agreements--cookie","cookie_notice","cookieconsentmodal","yoyoCookie","footer_tc_privacy"],l=["email-newsletter-dialog","subscribe_modal_container","paywall-container-com","adblockermessag","newsletter-popup","data-newsletter-floater","engagement-banner","survey-prompt","dialog-modal-valuesurvey","adblock-notice","onesignal-popover","popup-subcription-background","promotionalpopup","mfp-newsletter","pushcrew-chrome-style-notification","adblockModal","fbs-auth__adblock","newsletter-signup--popup"],p=(e,o)=>{const t={path:{19:`../img/icon19${e=e?"":"off"}.png`,38:`../img/icon38${e}.png`}};void 0!==o?t.tabId=o:h=!e,chrome.browserAction.setIcon(t)},d=e=>{const o={jsInject:!0,cssInject_pre:!0,cssInject_post:!0,runAllFrames:!0,showElemsBlocked:!0,clickDismissNotif:!0,strictFilters:!0,blockOtherNotifications:!1,enableLockedFeatures:!0,activityNotif:!1};return e&&(o.enableCNB=!0,o.whitelist=[]),o},m=e=>{chrome.storage.sync.set(d(e),()=>{chrome.runtime.sendMessage({options:"setDefaults"})})},g=()=>{f||(f=!0,chrome.windows.getAll({populate:!0},e=>{e.forEach(e=>{e.tabs.forEach(e=>{const o=e.id;e.url&&!e.url.startsWith("https://chrome.google.com/webstore")&&chrome.runtime.getManifest().content_scripts[0].js.forEach(e=>{try{chrome.tabs.executeScript(o,{file:e})}catch(e){}})})})}))},u=()=>{const e=e=>{try{document.querySelector(e)}catch(e){return!1}return!0};return e(":matches(:matches(*))")?":matches":e(":-webkit-any(:-webkit-any(*))")?":-webkit-any":e(":-moz-any(:-moz-any(*))")?":-moz-any":e(":is(:is(*))")?":is":void 0},b=()=>{((o,p)=>{const m=new XMLHttpRequest;m.open("GET","../html/notif.html",!0),m.onreadystatechange=()=>{var o;4===m.readyState&&200===m.status&&(o=m.responseText,chrome.storage.sync.get(p=>{const m=u(),b=(v="",c.forEach(e=>{v+=`:not(.${e})`}),v),h=(()=>{var e="";return a.forEach(o=>{e+=`:not(${o})`}),e.toLowerCase()+b})(),f=void 0!==p.blockOtherNotifications&&p.blockOtherNotifications;var v;const k=(e,o=["id","class"])=>{const t=(e,t="*")=>{var n="";o.forEach(o=>{n+=`,[${o}${t}="${e}"]`});const i=n.replace(/-/g,"_").replace(n,"");return n+i+n.replace(/_/g,"-").replace(i,"").replace(n,"")};if("string"==typeof e)return t(e);var n="";for(var i in e)e[i].forEach(e=>{n+=t(e,i)});return n},y=i(`.fsBody[style*="padding-top"]{padding-top:0}html,body,.qc-cmp-ui-showing{overflow:initial;pointer-events:initial}body.has-squarespace-banner,.cookiesMessage+.pagewrap .headerContainer,.cookiesMessage+.pagewrap .landingPageWelcomeSection{margin-top:0}.ccgtm-noscroll{position:unset}.onetrust-placeholder[data-type="targeting"],[data-testid="gdpr-dock"],#ot-sdk-btn,.modal-backdrop,.ui-widget-overlay,[class^="sp_veil"],[data-qa*="site.alert"],.modal__curtain--visible,[id="privacynotification"],body.screen>.screen${f?",.tloom-lb_overlay":""}{display:none;visibility:hidden;opacity:0;height:0;width:0;pointer-events:none;}.sp-message-open{overflow:auto;position:initial;margin-top:0}[data-reactroot]:not([id*="ib-section"])>*:not([class*="responsive"]):not(header):not(.page-loader-component):not([class*="FullscreenSearch"]):not([class*="date-picker"]):not([class^="cms"]),.mol-ads-cmp--open #page-container{overflow:auto;max-height:100%}body.scroll_freeze{position:initial}#__next>div{overflow:auto;max-height:none}[class*="reactmodal"].noscroll{position:initial}#react-root>.page-wrapper{height:unset}.ContentWrapper,div[class*="header"],div[class*="signup_wall"] *{filter:none}body[class*="fp-viewing"]{overflow:hidden}.header-holder{visibility:initial}.eugdpr-disabled,.eugdpr-disabled a{pointer-events:unset;user-select:unset}html.mol-ads-cmp--open,.mol-ads-cmp--open>body>.page{padding-bottom:0;max-height:unset}`),w={notifHTML:i(o).replace("</style>","@keyframes RTIDanim{0%{transform:scale(0)}50%{transform:scale(0)}75%{transform:scale(1.1)}100%{transform:scale(1)}}</style>").replace(/RTID/g,e+"_notif").replace("../img/bubble.svg",chrome.extension.getURL("../img/bubble.svg")).replace("../img/icon48.png",chrome.extension.getURL("../img/icon48.png")),localInitialiserValidator:f.toString()+chrome.app.getDetails().version+m,postCSS:y,postCSSobj:(()=>{let e=y.split("}");e.pop();for(const o in e){const t=e[o].split("{");e[o]=[t[0],t[1].split(";")]}return e})(),badSelector:h,unfilteredElemSelector:void 0!==m?m+'([class$="-1-"],[id^="ccc-"])'+h:null,preCSSselect:(()=>{var e="";const o=(t="",r.concat(["link","gdpr","policy"]).forEach(e=>{t+=k("cookie"+e)+k("cookie-"+e)}),f&&(t+=',[style*="z-index: 999999; background: rgba(0, 0, 0, 0.8); display: block"],[style*="position: fixed; top: 0px; left: 0px; right: 0px; bottom: 0px; background: rgba(0, 0, 0, 0.7); z-index: 99999"]',l.forEach(e=>{t+=`,[${e}]`})),'[data-cookiebanner="banner"],[aria-label*="cookieconsen"],[data-testid*="cookie-policy"],[data-tracking-opt-in-overlay]'+k({"":["modal-options--cookie","cmp-content-wrapper","consent-notification","butterBar--privacy"],"^":["sp_message_container"],"*":["gdpr-cookieconsent","cookie-ui","gdpr-notif","cookiesbanner","cookies-use","evidon-banner","evidon-consent","evidon-barrier","overlay-message--cookie","cookie-accept-modal","cc-cookie","optanon-alert-box"]})+k({"":["cmpcontainer","_evidon-message","_evidon_banner","_evidon-accept-button","_evidon-option-button","iubenda-cs-banner","privacy-consent","cookie-o-matic-banner","debCNwrap"],"^":["truste-consent","optanon-popup"]},["id"])+t);var t;const n=e=>m+`(${e})`;if((()=>{const e=s.concat(["gdpr-consen","gdpr-banner","cookie-bar","cookie-notif","js-cookies-eu","cookie-container","app-gdpr"]);return f?e.concat(l):e})().forEach(o=>{e+=k(o)}),e+=',.squarespace-banner.--is-cookie,ugc-cookie-banner,[data-qa*="cookie-message"]',void 0!==m){e=n(e.substring(1))+h.replace(b,"")+",";var i="div"+n(o);f&&(i+=",iframe"+n('[id^="offer-"],[title^="offer-"],[name^="offer-"]')),e+=i}else e=(e+",").substring(1).replace(/,/g,h+",")+"div"+o.replace(/,/g,b+",div")+b,f&&(e+=","+'iframe[id^="offer-"],iframe[title^="offer-"],iframe[name^="offer-"],'.replace(/,/g,b+","));return","===e.slice(-1)&&(e=e.slice(0,-1)),void 0!==m&&(e=n(e)+b),(e+',.ion-page .consent-banner,[id="cookie-container"][data-cookie-toggle-id]').replace(/"]/g,'"i]')})()};chrome.storage.local.set(w,()=>{chrome.storage.local.get(e=>{let o=n(w),i=d(!0),r=n(i);{const e={};for(let o in i)void 0===p[o]&&(e[o]=i[o]);Object.getOwnPropertyNames(e).length>0?chrome.storage.sync.set(e,()=>{g()}):g()}for(let n in e)t(n,o)||chrome.storage.local.remove(n);for(let e in p)t(e,r)||chrome.storage.sync.remove(e)})})}))},m.send()})()};let h=!0,f=!1;chrome.runtime.onMessage.addListener((e,o,t)=>{if(void 0!==e.msg)"number"==typeof e.msg?chrome.browserAction.getBadgeText({tabId:o.tab.id},t=>{chrome.browserAction.setBadgeText({text:e.msg>0&&h?e.msg.toString():"",tabId:o.tab.id})}):"E"===e.msg?p(!0,o.tab.id):"D"===e.msg?p(!1,o.tab.id):chrome.tabs.sendMessage(o.tab.id,{iframeElemList:e.msg});else{if(void 0!==e.getURL)return void t(o.tab.url);void 0!==e.setDefault?m():void 0!==e.initialise&&b()}t()}),chrome.browserAction.onClicked.addListener(o=>{"string"==typeof o.url&&o.url.includes("://")?chrome.runtime.openOptionsPage((function t(){o.url.startsWith("chrome")?o.url.startsWith("chrome-extension://"+e)&&!o.url.endsWith("Options")&&window.open(`chrome-extension://${e}/${chrome.runtime.getManifest().options_page}`):setTimeout(()=>{chrome.runtime.sendMessage({options:"temp_whitelist_entry:"+o.url.substring(o.url.indexOf("://")+3).split("/")[0]},e=>{"success"!==e&&t()})},200)})):chrome.runtime.openOptionsPage()}),chrome.storage.onChanged.addListener((e,o)=>{"sync"===o&&(b(),e.enableCNB&&(e.enableCNB.newValue?p(!0):p(!1)))}),chrome.storage.sync.get(["enableCNB","blockOtherNotifications"],e=>{void 0!==e.enableCNB?(e.enableCNB?chrome.browserAction.setBadgeText({text:""},()=>{p(!0)}):p(!1),chrome.storage.local.get(["localInitialiserValidator"],o=>{o.localInitialiserValidator!==e.blockOtherNotifications.toString()+chrome.app.getDetails().version+u()?b():g()})):m(!0)});
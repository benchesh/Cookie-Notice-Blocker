/* Developed by Ben Cheshire */
"use strict";(()=>{const e=e=>null!=e&&""!==e,t=e=>document.getElementById(e),i=e=>document.querySelectorAll(e),n=e=>s(t(e)),s=e=>e.style;(()=>{var s,l,o,c,a=[];function r(){t("whitelistInput").value=t("whitelistInput").value.replace(/\s/g,""),t("whitelistInput").value.length>4?w("whitelistAddButton"):p("whitelistAddButton")}function u(e){var i=[];for(const e of t("whitelistSelect").getElementsByTagName("option"))i.push(e.textContent);(e||a.toString()!==i.toString())&&(a=i.slice(0),chrome.storage.sync.set({whitelist:i}),d())}function d(){a.length>0?(n("whitelistWrapper").display="block",n("whitelist_empty").display="none"):(n("whitelistWrapper").display="none",n("whitelist_empty").display="block")}function h(){t("enableCNB").checked?w("allOptions"):p("allOptions"),t("injectMe").value.includes("jsInject")?w("hideMe"):p("hideMe")}function p(e){t(e).classList.add("optDisabled")}function w(e){t(e).classList.remove("optDisabled")}function m(){chrome.storage.sync.get(n=>{t("enableCNB").checked=n.enableCNB,n.jsInject?n.cssInject_pre?t("injectMe").value="cssInject_preAjsInject":t("injectMe").value="jsInject":n.cssInject_pre&&(t("injectMe").value="cssInject_pre"),i('input[type="checkbox"]').forEach(e=>{t(e.id).checked=n[e.id]}),h(),a=n.whitelist.slice(0);for(var s=!1,l="",o=0;o<a.length;o++){const t=a[o];e(t)?l+=`<option value="${o}">${t}</option>`:s=!0}t("whitelistSelect").innerHTML=l,d(),s&&u(!0)})}function g(){const e={jsInject:t("injectMe").value.includes("jsInject"),cssInject_pre:t("injectMe").value.includes("cssInject_pre")};i('input[type="checkbox"]').forEach(t=>{e[t.id]=t.checked}),chrome.storage.sync.set(e)}function v(){m();var e=n("optionssaved");e.transition="all 0.2s ease",e.opacity="1",e.color="red",setTimeout(()=>{e.color="black"},200),clearTimeout(c),c=setTimeout(()=>{e.transition="all 3s ease",e.opacity="0"},1500)}window.addEventListener(document.currentScript.src,i=>{t("whitelistRemoveButton").addEventListener("click",e=>{const i=y(t("whitelistSelect"));clearTimeout(o),i.length>0?(n("whitelist_noentries_msg").display="none",i.forEach(e=>{t("whitelistSelect").removeChild(t("whitelistSelect").querySelector(`option[value="${e}"]`))}),u()):(n("whitelist_noentries_msg").display="block",o=setTimeout(()=>{n("whitelist_noentries_msg").display="none"},2e3))}),t("whitelistAddButton").addEventListener("click",i=>{e(t("whitelistInput").value)&&(clearTimeout(l),n("whitelist_dupe_msg").display="none",clearTimeout(s),n("whitelist_tooLarge_msg").display="none",a.includes(t("whitelistInput").value)?(n("whitelist_dupe_msg").display="block",l=setTimeout(()=>{n("whitelist_dupe_msg").display="none"},2e3)):100>a.length?(t("whitelistSelect").innerHTML+=`<option value="${a.length}">${t("whitelistInput").value}</option>`,u(),t("whitelistInput").value="",r()):(n("whitelist_tooLarge_msg").display="block",s=setTimeout(()=>{n("whitelist_tooLarge_msg").display="none"},2e3)))}),t("setDefault").addEventListener("click",e=>{chrome.runtime.sendMessage({setDefault:""})}),m(),t("mainOptions").onchange=()=>{h(),g()},t("enableCNB").onchange=()=>{h(),g()},r(),t("whitelistInput").addEventListener("input",()=>{r()},!1)}),window.addEventListener("whitelistInputLengthCheck",()=>{r()}),chrome.storage.onChanged.addListener((e,t)=>{"sync"===t&&v()}),document.addEventListener("savedMessage",()=>{v()});var y=e=>{var t=[];for(const i of e.selectedOptions)t.push(i.value);return t}})()})();